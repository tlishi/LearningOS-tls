# 进程及进程管理

## 进程的系统调用

* fork

  * 创建子进程，返回值与进程有关

* exec

  * 清空当前进程地址空间，加载一个可执行文件，然后返回用户态执行

* waitpid

  * | 参数       | 说明                    |
    | ---------- | ----------------------- |
    | pid        | -1表示等待任一子进程    |
    | exit_code  | 0表示子进程返回值不保存 |
    | **返回值** |                         |
    | -1         | 要等待子进程不存在      |
    | -2         | 要等待子进程未结束      |
    | n          | 返回子进程id            |

## 用户初始化程序和shell程序

* initproc
  * 通过fork和exec创建shell程序
  * 自身检测僵尸进程
* shell
  * 维护一个`line`字符串用于记录用户输入
  * `getchar`调用读取用户输入的一个字符，匹配并处理
    * 回车
    * 退格/删除
    * 一个字符


## 进程管理的数据结构

* 静态变量`APP_NAMES`将所有应用名字保存在内存中
* 进程标识符
  * `PID_ALLOCATOR`完成pid管理
* 内核栈
  * 通过进程标识符来确定进程内核栈在地址空间中位置
* 进程控制块
  * 将`TCB`修改，变成`PCB`
  * 分为不可变和可变部分
    * pid和内核栈初始化后不变
    * 一些地址空间，任务状态等可变信息封装
* 任务管理
  * 双端队列`VecDeque`保存任务，通过FIFO算法调度
* 处理器管理（分担任务管理器功能，维护CPU状态）
  * 一些`impl Processor`方法可以获取当前任务或拷贝一份，还可以获取更多信息
  * idle控制流
    * 从任务管理器选出一个任务来在当前核执行
    * 核心是通过`_switch`来切换，形成循环执行

## 进程管理实现

* 实现fork、exce、waitpid等



查看学习智能指针Arc、Weak
